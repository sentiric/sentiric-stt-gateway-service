
services:
  stt-gateway-service:
    build: 
      context: .
      dockerfile: Dockerfile
    env_file:
      - .env
    volumes:
      - .:/app
      - ../sentiric-certificates:/sentiric-certificates:ro
    environment:
      - ENV=development
      - RUST_LOG=debug
      - STT_WHISPER_SERVICE_GRPC_URL=http://mock-whisper-engine:50051
    command: cargo run --release
    depends_on:
      - mock-whisper-engine

  # Mock Whisper Engine: gRPC testi için basit bir sunucu
  # (Gerçek C++ Whisper servisi ağır olduğu için dev modunda bunu kullanabiliriz)
  mock-whisper-engine:
    image: gripmock/gripmock:latest
    container_name: sentiric-mock-whisper
    networks:
      - sentiric-net
    ports:
      - "50051:50051"
    # Proto dosyasını bind-mount ederek otomatik mock oluşturur
    volumes:
      - ../sentiric-contracts/proto/sentiric/stt/v1:/proto
    command: ["/proto/whisper.proto"] 